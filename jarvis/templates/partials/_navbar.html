{#
    Global Navbar Partial - Main navigation for JARVIS pages
    Usage: {% include 'partials/_navbar.html' %}

    Required variables:
        - current_module: Module key (accounting, hr, settings, apps, etc.)

    Optional variables:
        - page_title: Override the default title for current_module
        - page_icon: Override the default icon for current_module
        - navbar_class: Additional navbar classes (default: "navbar-dark bg-primary")
        - container_class: Container class (default: "container-fluid")
        - show_online_users: Show online users indicator (default: true)
        - extra_buttons: List of extra button dicts with {url, icon, label, class}
#}

{# Centralized module configuration - single source of truth #}
{% set module_config = {
    'accounting': {'title': 'Accounting', 'icon': 'bi-calculator'},
    'statements': {'title': 'Statements', 'icon': 'bi-file-earmark-text'},
    'hr': {'title': 'HR - Events', 'icon': 'bi-people'},
    'ai_agent': {'title': 'AI Agent', 'icon': 'bi-robot'},
    'settings': {'title': 'Settings', 'icon': 'bi-gear'},
    'apps': {'title': 'Applications', 'icon': 'bi-grid'},
    'guide': {'title': 'Guide', 'icon': 'bi-book'},
    'connectors': {'title': 'Connectors', 'icon': 'bi-plug'}
} %}

{% set current_config = module_config.get(current_module, {'title': '', 'icon': ''}) %}
{% set navbar_class = navbar_class | default('navbar-dark bg-primary') %}
{% set container_class = container_class | default('container-fluid') %}
{% set show_online_users = show_online_users | default(true) %}
{% set page_title = page_title | default(current_config.title) %}
{% set page_icon = page_icon | default(current_config.icon) %}

<nav class="navbar {{ navbar_class }}">
    <div class="{{ container_class }}">
        <a class="navbar-brand mb-0 h1" href="/apps" id="navbarLogo">
            <span class="navbar-logo-icon"></span> J.A.R.V.I.S.
        </a>
        <span class="navbar-text text-white me-auto ms-3">
            {% if page_icon %}<i class="bi {{ page_icon }}"></i>{% endif %} {{ page_title | default('') }}
            {% if show_online_users %}
            <span class="badge bg-light text-success ms-2" id="onlineUsersIndicator" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true" title="Loading..." style="cursor: pointer; font-size: 0.7rem;">
                <i class="bi bi-circle-fill text-success" style="font-size: 0.4rem;"></i> <span id="onlineUsersCount">-</span> online
            </span>
            {% endif %}
        </span>
        <div class="d-flex align-items-center gap-2">
            <!-- Theme Toggle -->
            <div class="theme-switch">
                <i class="bi bi-sun-fill"></i>
                <input type="checkbox" id="themeToggle" title="Toggle Dark/Light Theme">
                <i class="bi bi-moon-fill"></i>
            </div>
            <!-- Module Menu -->
            {% include 'partials/_module_menu.html' %}
            <!-- Extra Buttons (page-specific) -->
            {% if extra_buttons %}
                {% for btn in extra_buttons %}
                <a href="{{ btn.url }}" class="{{ btn.class | default('btn btn-outline-light btn-sm') }}" {% if btn.title %}title="{{ btn.title }}"{% endif %}>
                    {% if btn.icon %}<i class="bi {{ btn.icon }}"></i>{% endif %}
                    {% if btn.label %}<span class="d-none d-md-inline ms-1">{{ btn.label }}</span>{% endif %}
                </a>
                {% endfor %}
            {% endif %}
            <!-- User Dropdown -->
            {% include 'partials/_user_dropdown.html' %}
        </div>
    </div>
</nav>
